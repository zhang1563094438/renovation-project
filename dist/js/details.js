"use strict";function asyncGeneratorStep(t,e,n,s,o,i,a){try{var r=t[i](a),l=r.value}catch(t){return void n(t)}r.done?e(l):Promise.resolve(l).then(s,o)}function _asyncToGenerator(r){return function(){var t=this,a=arguments;return new Promise(function(e,n){var s=r.apply(t,a);function o(t){asyncGeneratorStep(s,e,n,o,i,"next",t)}function i(t){asyncGeneratorStep(s,e,n,o,i,"throw",t)}o(void 0)})}}$(function(){var s=null,o=getCookie("goods_id");function t(){return(t=_asyncToGenerator(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,$.get("/zhang/getGoodsInfo.php",{goods_id:o},null,"json");case 2:n=t.sent,e=n.info,$(".enlargeBox").html('\n        <div class="show">\n                <img src="'.concat(e.goods_big_logo,'" alt="">\n                <div class="mask"></div>\n            </div>\n            <div class="list">\n                <p class="active">\n                    <img src="').concat(e.goods_small_logo,'" show="').concat(e.goods_small_logo,'" alt="">\n                </p>\n                <p>\n                    <img src="../images/logo.png" show="../images/logo.png" alt="">\n                </p>\n            </div>\n            <div class="enlarge"></div>\n        ')),$(".goodsInfo").html('\n        <p class="desc">'.concat(e.goods_name,'</p>\n        <div class="btn-group size">\n            <button type="button" class="btn btn-default">S</button>\n            <button type="button" class="btn btn-default">M</button>\n            <button type="button" class="btn btn-default">L</button>\n            <button type="button" class="btn btn-default">XL</button>\n        </div>\n        <p class="price">\n            ￥ <span class="text-danger">').concat(e.goods_price,'</span>\n        </p>\n        <div class="num">\n            <button class="subNum">-</button>\n            <input type="text" value="1" class="cartNum">\n            <button class="addNum">+</button>\n        </div>\n        <div>\n            <button class="btn btn-success addCart">添加购物车</button>\n            <button class="btn btn-warning continue"><a href="./list.html">再次去购物</a></button>\n        </div>\n        ')),$(".goodsDesc").html(e.goods_introduce),new i(".enlargeBox"),s=n.info;case 5:case"end":return t.stop()}var e},t)}))).apply(this,arguments)}function i(t){this.ele=document.querySelector(t),this.show=this.ele.querySelector(".show"),this.mask=this.ele.querySelector(".mask"),this.enlarge=this.ele.querySelector(".enlarge"),this.show_width=this.show.clientWidth,this.show_height=this.show.clientHeight,this.enlarge_width=parseInt(window.getComputedStyle(this.enlarge).width),this.enlarge_height=parseInt(window.getComputedStyle(this.enlarge).height),this.bg_width=parseInt(window.getComputedStyle(this.enlarge).backgroundSize.split(" ")[0]),this.bg_height=parseInt(window.getComputedStyle(this.enlarge).backgroundSize.split(" ")[1]),this.list=this.ele.querySelector(".list"),this.init()}!function(){t.apply(this,arguments)}(),$(".goodsInfo").on("click",".addCart",function(){var t,e=JSON.parse(window.localStorage.getItem("cart"))||[];e.some(function(t){return t.goods_id===o})?(t=e.fiflter(function(t){return t.goods_id})[0]).cart_number=+t.cart_number+ +$(".cartNum").val():(s.cart_number=1,e.push(s)),window.localStorage.setItem("cart",JSON.stringify(e))}),$(".goodsInfo").on("click",".subNum",function(){var t=+$(".cartNum").val();1!=t&&$(".cartNum").val(t-1)}).on("click",".addNum",function(){var t=+$(".cartNum").val();$(".cartNum").val(1+t)}),i.prototype.init=function(){this.setScale(),this.overOut(),this.move(),this.change()},i.prototype.setScale=function(){this.mask_width=this.show_width*this.enlarge_width/this.bg_width,this.mask_height=this.show_height*this.enlarge_height/this.bg_height,this.mask.style.width=this.mask_width+"px",this.mask.style.height=this.mask_height+"px"},i.prototype.overOut=function(){var t=this;this.show.addEventListener("mouseover",function(){t.mask.style.display="block",t.enlarge.style.display="block"}),this.show.addEventListener("mouseout",function(){t.mask.style.display="none",t.enlarge.style.display="none"})},i.prototype.move=function(){var n=this;this.show.addEventListener("mousemove",function(t){var e=(t=t||window.event).offsetX-n.mask_width/2,t=t.offsetY-n.mask_height/2;console.log(e),console.log(t),e<=0&&(e=0),t<=0&&(t=0),e>=n.show_width-n.mask_width&&(e=n.show_width-n.mask_width),t>=n.show_height-n.mask_height&&(t=n.show_height-n.mask_height),n.mask.style.left=e+"px",n.mask.style.top=t+"px";e=n.enlarge_width*e/n.mask_width,t=n.enlarge_height*t/n.mask_height;n.enlarge.style.backgroundPosition="-".concat(e,"px -").concat(t,"px")})},i.prototype.change=function(){var o=this;this.list.addEventListener("click",function(t){var e=(t=t||window.event).target||t.srcElement;if("IMG"===e.nodeName){var n=e.getAttribute("show"),t=e.getAttribute("enlarge");o.show.firstElementChild.src=n,o.enalrge.style.backgroundImage="url(".concat(t,")");for(var s=0;s<o.list.children.length;s++)o.list.children[s].classList.remove("active");e.parentElement.classList.add("active")}})}});